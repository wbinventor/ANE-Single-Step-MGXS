%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simulation Tools}
\label{sec:simulation-tools}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This work employed both continuous energy and multi-group neutron transport codes. The OpenMC Monte Carlo code~\citep{romano2013openmc} was generated multi-group cross sections and reference solutions as discussed in~\autoref{subsec:openmc}. The MGXS generated by OpenMC were used by the OpenMOC code~\citep{boyd2014openmoc} for deterministic multi-group transport calculations as highlighted in~\autoref{subsec:openmoc}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Continuous Energy Calculations with OpenMC}
\label{subsec:openmc}

The OpenMC continuous energy Monte Carlo (MC) code \citep{romano2013openmc} was employed to generate multi-group cross sections, and reference eigenvalues and pin-wise fission and capture reaction rates. The \texttt{openmc.mgxs} Python module was used to tally multi-group cross sections in CASMO's seventy energy group structure~\citep{rhodes2006casmo} from a single eigenvalue calculation. The multi-group cross sections were calculated with OpenMC's distributed cell tally algorithm~\citep{lax2014distribcell}, which permits spatial tally zones across repeated cell instances. In particular, unique MGXS were computed for each fuel pin cell with distributed cell tallies~\citep{lax2014distribcell} in the repeating lattice benchmarks described in~\autoref{sec:test-cases}. The OpenMC simulations were performed with 1000 batches with 10$^{6}$ particle histories per batch for each benchmark. Stationarity of the fission source was obtained with 100 inactive batches for each benchmark.

The OpenMC simulations used the ``iso-in-lab'' feature to enforce isotropic in lab scattering. The ``iso-in-lab'' feature samples the outgoing neutron energy from the scattering laws prescribed by the continuous energy cross section library, but the outgoing neutron direction of motion is sampled from an isotropic in lab distribution. Although isotropic in lab scattering is a poor approximation for LWRs, it eliminated scattering source anisotropy as one possible cause of approximation error between OpenMC and OpenMOC. This simplification made it possible to isolate the approximation error resulting from the spatial self-shielding model used to generate MGXS.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Multi-Group Calculations with OpenMOC}
\label{subsec:openmoc}

The OpenMOC code~\citep{boyd2014openmoc} was employed to use the MGXS generated by OpenMC for deterministic multi-group calculations. The OpenMOC code is a 2D method of characteristics code designed for fixed source and eigenvalue neutron transport calculations. OpenMOC approximates the scattering source as isotropic in the lab coordinate system, and discretizes the geometry into flat source regions (FSRs) which approximate the neutron source as constant across each spatial zone. The OpenMOC eigenvalue and energy-integrated, pin-wise reaction rates were compared with the reference solution computed by OpenMC.

Each OpenMOC simulation used a characteristic track laydown with 128 azimuthal angles and 0.05 cm spacing. All eigenvalue calculations were converged to 10$^{-5}$ on the root mean square of the energy-integrated fission source in each FSR. The Coarse Mesh Finite Difference (CMFD) acceleration scheme was employed on a pin-wise spatial mesh to reduce the number of iterations required to converge the fine-mesh transport calculations. The 70-group MGXS used for MOC were collapsed to a 14-group structure for CMFD to significantly improve the speed of the CMFD eigenvalue calculations.